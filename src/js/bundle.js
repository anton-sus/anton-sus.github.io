const apiKey="36783e67c693e40318a73ec3be962cfb",limit=1;function fetchCityData(t){t=`http://api.openweathermap.org/geo/1.0/direct?q=${t}&limit=${limit}&appid=`+apiKey;return fetch(t).then(t=>t.json()).then(t=>{if(0<t.length)return{lat:t[0].lat,lon:t[0].lon,name:t[0].name,state:t[0].state,country:t[0].country};throw new Error("Не найдено местоположение для указанного города")}).catch(t=>console.error("Ошибка:",t))}function fetchWeatherData(t,e){t=`https://api.openweathermap.org/data/2.5/weather?units=metric&lat=${t}&lon=${e}&appid=`+apiKey;return fetch(t).then(t=>t.json()).then(t=>t)}function fetchForecastData(t,e){t=`http://api.openweathermap.org/data/2.5/forecast?units=metric&lat=${t}&lon=${e}&appid=`+apiKey;return fetch(t).then(t=>t.json()).then(t=>t)}let searchInput=document.getElementById("search-input"),searchButton=document.getElementById("search-button"),cityTitle=document.getElementById("city-title"),cityInfo=document.getElementById("city-info"),temperature=document.getElementById("conditions-temp"),windSpeed=document.getElementById("conditions-wind-speed"),currentDateElement=document.getElementById("current-date"),temperatureChartInstance,latitude,longitude,jsonWheatherData;const defaultCity="London";function getDataForCity(e){fetchCityData(e).then(t=>{console.log(t.lat,t.lon);var e=`${t.state} (${t.country}): ${t.lat}°N, ${t.lon}°E`;return latitude=t.lat,longitude=t.lon,cityTitle.innerHTML=t.name,cityInfo.innerHTML=e,searchInput.style.display="none",fetchWeatherData(t.lat,t.lon)}).then(t=>(temperature.innerHTML=Math.round(t.main.temp)+"°",windSpeed.innerHTML=Math.round(t.wind.speed),localStorage.setItem("searches",JSON.stringify(e)),fetchForecastData(latitude,longitude))).then(t=>{console.log(t),setDate(),temperatureChartInstance&&temperatureChartInstance.destroy();var e=document.getElementById("temperatureChart");createChart(getDataForChart(t),e)}).catch(t=>{console.error("Ошибка:",t)})}function createChart(t,e){var a=[{label:"Temperature (°C)",data:t.temperatures,borderColor:"rgb(186, 53, 46)",borderWidth:2,pointRadius:0,lineTension:.4,yAxisID:"temperature-axis"},{label:"Pressure (hPa)",data:t.pressures,borderColor:"rgb(100, 100, 100)",borderWidth:2,pointRadius:0,lineTension:.4,yAxisID:"pressure-axis"}];temperatureChartInstance=new Chart(e,{type:"line",plugins:[{afterLayout:t=>{var e=t.ctx,a=(e.save(),t.scales["temperature-axis"]),n=a.getPixelForValue(0),r=e.createLinearGradient(0,a.top,0,a.bottom),a=(r.addColorStop(0,"red"),1/a.bottom*n);r.addColorStop(a,"darkviolet"),r.addColorStop(a,"darkviolet"),r.addColorStop(1,"blue"),t.data.datasets[0].borderColor=r,e.restore()}}],data:{labels:t.timeLabels,datasets:a},options:{scales:{y:{display:!1},"pressure-axis":{title:{display:!0,text:"hPa"},type:"linear",beginAtZero:!1,max:1040,position:"right",ticks:{stepSize:10,color:"rgb(100, 100, 100)"}},"temperature-axis":{title:{display:!0,text:"°C"},beginAtZero:!0,position:"left",ticks:{stepSize:2,color:function(t){return 0<t.tick.value?"rgb(186, 53, 46)":t.tick.value<=0?"rgb(100, 120, 255)":(console.log(t.tick.value),"#000000")}},grid:{}},x:{time:{tooltipFormat:"DD T"},ticks:{color:function(t){console.log(t)}}}},plugins:{legend:{display:!1}}}})}function getDataForChart(t){t=t.list;const n=[],r=[],o=[];return t.forEach(t=>{var e=new Date(t.dt_txt),a=t.main.temp,t=t.main.pressure;n.push(e.toLocaleTimeString("ru-RU",{hour12:!1})),r.push(a),o.push(t)}),{timeLabels:n,temperatures:r,pressures:o}}function setDate(){var t=(new Date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});currentDateElement.textContent=t}getDataForCity(defaultCity),document.addEventListener("DOMContentLoaded",function(){searchInput.style.display="none",searchButton.addEventListener("click",function(){"none"===searchInput.style.display?(searchInput.style.display="block",searchInput.value=null,searchInput.focus()):searchInput.style.display="none"}),document.addEventListener("click",function(t){searchInput.contains(t.target)||"search-button"===t.target.id||(searchInput.style.display="none")}),searchInput.addEventListener("keydown",function(t){"Enter"===t.key&&(cityName=searchInput.value,console.log(cityName),getDataForCity(cityName))})});