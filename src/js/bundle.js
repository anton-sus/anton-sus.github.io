const apiKey="36783e67c693e40318a73ec3be962cfb",limit=1;function fetchCityData(e){e=`http://api.openweathermap.org/geo/1.0/direct?q=${e}&limit=${limit}&appid=`+apiKey;return fetch(e).then(e=>e.json()).then(e=>{if(0<e.length)return{lat:e[0].lat,lon:e[0].lon,name:e[0].name,state:e[0].state,country:e[0].country};throw new Error("Не найдено местоположение для указанного города")}).catch(e=>console.error("Ошибка:",e))}function fetchWeatherData(e,t){e=`https://api.openweathermap.org/data/2.5/weather?units=metric&lat=${e}&lon=${t}&appid=`+apiKey;return fetch(e).then(e=>e.json()).then(e=>e)}function fetchForecastData(e,t){e=`http://api.openweathermap.org/data/2.5/forecast?units=metric&lat=${e}&lon=${t}&appid=`+apiKey;return fetch(e).then(e=>e.json()).then(e=>e)}let searchInput=document.getElementById("search-input"),searchButton=document.getElementById("search-button"),cityTitle=document.getElementById("city-title"),cityInfo=document.getElementById("city-info"),temperature=document.getElementById("conditions-temp"),windSpeed=document.getElementById("conditions-wind-speed"),currentDateElement=document.getElementById("current-date"),temperatureChartInstance,latitude,longitude,jsonWheatherData;const defaultCity="London";function getDataForCity(t){fetchCityData(t).then(e=>{console.log(e.lat,e.lon);var t=`${e.state} (${e.country}): ${e.lat}°N, ${e.lon}°E`;return latitude=e.lat,longitude=e.lon,cityTitle.innerHTML=e.name,cityInfo.innerHTML=t,searchInput.style.display="none",fetchWeatherData(e.lat,e.lon)}).then(e=>(temperature.innerHTML=Math.round(e.main.temp)+"°",windSpeed.innerHTML=Math.round(e.wind.speed),localStorage.setItem("searches",JSON.stringify(t)),fetchForecastData(latitude,longitude))).then(e=>{console.log(e),setDate(),temperatureChartInstance&&temperatureChartInstance.destroy();var t=document.getElementById("temperatureChart");createChart(getDataForChart(e),t)}).catch(e=>{console.error("Ошибка:",e)})}function createChart(e,t){var n=[{label:"Temperature (°C)",data:e.temperatures,borderColor:"rgb(186, 53, 46)",borderWidth:2,pointRadius:0,lineTension:.4,yAxisID:"temperature-axis"},{label:"Pressure (hPa)",data:e.pressures,borderColor:"rgb(24, 90, 161)",borderWidth:2,pointRadius:0,lineTension:.4,yAxisID:"pressure-axis"}];temperatureChartInstance=new Chart(t,{type:"line",data:{labels:e.timeLabels,datasets:n},options:{scales:{y:{display:!1},"pressure-axis":{type:"linear",beginAtZero:!1,max:1040,position:"right",ticks:{stepSize:10,color:"rgb(24, 90, 161)"}},"temperature-axis":{beginAtZero:!0,position:"left",ticks:{stepSize:2,color:"rgb(186, 53, 46)"}},x:{grid:{}}},plugins:{legend:{display:!1}}}})}function getDataForChart(e){e=e.list;const a=[],r=[],o=[];return e.forEach(e=>{var t=new Date(e.dt_txt),n=e.main.temp,e=e.main.pressure;a.push(t.toLocaleTimeString("ru-RU",{hour12:!1})),r.push(n),o.push(e)}),{timeLabels:a,temperatures:r,pressures:o}}function setDate(){var e=(new Date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});currentDateElement.textContent=e}getDataForCity(defaultCity),document.addEventListener("DOMContentLoaded",function(){searchInput.style.display="none",searchButton.addEventListener("click",function(){"none"===searchInput.style.display?(searchInput.style.display="block",searchInput.value=null,searchInput.focus()):searchInput.style.display="none"}),document.addEventListener("click",function(e){searchInput.contains(e.target)||"search-button"===e.target.id||(searchInput.style.display="none")}),searchInput.addEventListener("keydown",function(e){"Enter"===e.key&&(cityName=searchInput.value,console.log(cityName),getDataForCity(cityName))})});